<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nomad Nexus</title>
    <script type="text/javascript">
        // Function to toggle form fields
        function toggleFormFields() {
            // Check which radio button is checked
            var knowWhereToGo = document.getElementById('choose').checked;
            
            // Get references to the form fields
            var destinationField = document.getElementById('destinationField');
            var travelMethodField = document.getElementById('travelMethodField');
            var travelPreferencesField = document.getElementById('travelPreferences');

            // If the user knows where they want to go, show all except climate preference
            if (knowWhereToGo) {
                destinationField.style.display = '';
                travelMethodField.style.display = '';
                travelPreferencesField.style.display = 'none'; // Hide climate preference
            } else {
                // If the user needs a recommendation, hide destination and show the rest
                destinationField.style.display = 'none'; // Hide destination field
                travelMethodField.style.display = '';
                travelPreferencesField.style.display = '';
            }
        }
    </script>
</head>
<body style="font-family: 'Arial', sans-serif; color: #333; padding: 20px; background-color: #f8f8f8; text-align: center;">
    {{#if user}}
        <h1 style="color: #4a90e2;">Welcome, {{user.first_name}}!</h1>
        <p style="margin-bottom: 30px;">Let's plan your next trip:</p>
        <form id="tripForm" action="/trip" method="post" style="display: inline-block; text-align: left; background-color: #fff; padding: 40px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); border-radius: 8px;">
            
            <!-- Radio buttons to toggle the form -->
            <div style="margin-bottom: 20px;">
                <input type="radio" id="choose" name="tripType" value="choose" checked onclick="toggleFormFields()">
                <label for="choose">I know where I want to go</label>
                <input type="radio" id="recommend" name="tripType" value="recommend" onclick="toggleFormFields()">
                <label for="recommend">Recommend a destination</label>
            </div>

            <!-- Destination field -->
            <div id="destinationField" style="margin-bottom: 20px;">
                <label for="destination" style="display: block; margin-bottom: 5px;">Your Destination:</label>
                <input type="text" id="destination" name="destination" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <!-- Travel dates field (shown in both cases) -->
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px;">When will you be going?</label>
                <div style="display: flex; justify-content: space-between;">
                    <div style="flex-grow: 1; margin-right: 10px;">
                        <label for="startDate" style="display: block; margin-bottom: 5px;">Arrival:</label>
                        <input type="date" id="startDate" name="startDate" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" title="Arrival">
                    </div>
                    <div style="flex-grow: 1;">
                        <label for="endDate" style="display: block; margin-bottom: 5px;">Departure:</label>
                        <input type="date" id="endDate" name="endDate" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" title="Departure">
                    </div>
                </div>
            </div>

            <!-- Budget field (always shown) -->
            <div style="margin-bottom: 20px;">
                <label for="budget" style="display: block; margin-bottom: 5px;">Your Budget ($):</label>
                <input type="number" id="budget" name="budget" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <!-- Travel method field (shown in both cases) -->
            <div id="travelMethodField" style="margin-bottom: 20px;">
                <label for="travelMethod" style="display: block; margin-bottom: 5px;">Preferred Means of Travel:</label>
                <select id="travelMethod" name="travelMethod" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="air">Air</option>
                    <option value="car">Car</option>
                    <option value="train">Train</option>
                    <option value="ship">Ship</option>
                </select>
            </div>

            <!-- Travel preferences field -->
            <div id="travelPreferences" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px;">What are your trip preferences?</label>
                <div>
                    <div style="margin-bottom: 10px;">
                        <input type="checkbox" id="mountains" name="tripPreferences" value="mountains">
                        <label for="mountains">Mountains</label>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <input type="checkbox" id="beach" name="tripPreferences" value="beach">
                        <label for="beach">Beach</label>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <input type="checkbox" id="city" name="tripPreferences" value="city">
                        <label for="city">City</label>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <input type="checkbox" id="countryside" name="tripPreferences" value="countryside">
                        <label for="countryside">Countryside</label>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <input type="checkbox" id="historicSites" name="tripPreferences" value="historicSites">
                        <label for="historicSites">Historic Sites</label>
                    </div>
                </div>
            </div>
            
            <!-- Submit button -->
            <button type="submit" style="background-color: #5cb85c; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; width: 100%;">Plan Trip</button>
        </form>
    {{else}}
        <h1>Welcome to Nomad Nexus!</h1>
        <p>To access personalized trip planning, please <a href="/login" style="color: #4a90e2; text-decoration: none;">login</a> or <a href="/register" style="color: #4a90e2; text-decoration: none;">register</a>.</p>
    {{/if}}
    
    <!-- Initialize form fields on page load -->
    <script type="text/javascript">
        // Call this function to set the initial state of the form fields
        toggleFormFields();

        // Function to set the minimum departure date based on the selected arrival date
        function setDepartureDate() {
            var arrivalDate = document.getElementById('startDate').value;
            var departureInput = document.getElementById('endDate');
            
            departureInput.min = arrivalDate; // Set the minimum value to the arrival date
            
            if (departureInput.value && arrivalDate > departureInput.value) {
                departureInput.value = arrivalDate;
            }
        }

        // Function to set the minimum start date to today's date
        function setMinStartDate() {
            var today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').min = today;
            document.getElementById('startDate').addEventListener('change', setDepartureDate);
        }

        // Set the minimum start date on page load
        setMinStartDate();

        document.getElementById('tripForm').addEventListener('submit', function(event) {
            var checkboxes = document.querySelectorAll('input[name="tripPreferences"]:checked');
            if (checkboxes.length === 0) {
                event.preventDefault();
                alert('Please select at least one trip preference.');
            }
        });
    </script>
</body>
</html>
